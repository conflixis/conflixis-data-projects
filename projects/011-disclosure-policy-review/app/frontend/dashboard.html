<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COI Policy Compliance Dashboard - Texas Health Resources</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configure Tailwind with Conflixis colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'conflixis-green': '#0c343a',
                        'conflixis-light-green': '#93baab',
                        'conflixis-white': '#ffffff',
                        'conflixis-gray': '#d1d5db',
                        'conflixis-gray-hover': '#b9bec4',
                        'conflixis-ivory': '#f8f5ef',
                        'conflixis-tan': '#c5bdae',
                        'conflixis-mint': '#93baab',
                        'conflixis-gold': '#eab96d',
                        'conflixis-blue': '#4c94ed',
                        'conflixis-red': '#fd7649',
                        'conflixis-success-green': '#008000FF',
                    },
                    fontFamily: {
                        'soehneLeicht': ['SoehneLeicht', 'sans-serif'],
                        'soehneKraftig': ['SoehneKraftig', 'sans-serif'],
                        'ivarDisplay': ['IvarDisplay', 'serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts -->
    <style>
        @font-face {
            font-family: 'SoehneLeicht';
            src: url('../../docs/design-system/conflixis-design-system/assets/fonts/soehne-leicht.woff2') format('woff2');
            font-weight: 300;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'SoehneKraftig';
            src: url('../../docs/design-system/conflixis-design-system/assets/fonts/soehne-kraftig.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'IvarDisplay';
            src: url('../../docs/design-system/conflixis-design-system/assets/fonts/IvarDisplay-Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }
        
        body {
            font-family: 'SoehneLeicht', sans-serif;
            background-color: #f8f5ef;
            color: #0c343a;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'IvarDisplay', serif;
            color: #0c343a;
        }
        
        /* Animations */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fade-in 0.6s ease-out forwards;
        }
        
        @keyframes grow-width {
            from { width: 0; }
        }
        
        .animate-bar {
            animation: grow-width 1.5s ease-out forwards;
        }
    </style>
    <style>
        /* Sidebar styles */
        .sidebar {
            width: 250px;
            transition: transform 0.3s ease;
        }
        
        .sidebar-collapsed {
            transform: translateX(-250px);
        }
        
        .main-content {
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }
        
        .main-content-expanded {
            margin-left: 0;
        }
        
        .sidebar-link {
            transition: all 0.2s ease;
        }
        
        .sidebar-link:hover {
            background-color: rgba(12, 52, 58, 0.1);
            padding-left: 1.25rem;
        }
        
        .sidebar-link.active {
            background-color: #0c343a;
            color: white;
        }
        
        .admin-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .admin-submenu.expanded {
            max-height: 200px;
        }
        
        .admin-toggle {
            transition: transform 0.3s ease;
        }
        
        .admin-toggle.rotated {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed h-full bg-white shadow-lg z-50">
        <div class="p-6 border-b">
            <div class="flex items-center space-x-3">
                <img src="../../docs/design-system/conflixis-design-system/assets/logos/conflixis-logo.png" 
                     alt="Conflixis" class="h-10 w-10">
                <div>
                    <h2 class="text-lg font-soehneKraftig text-conflixis-green">Disclosure Review</h2>
                    <p class="text-xs text-gray-600">Conflixis</p>
                </div>
            </div>
        </div>
        
        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="/" class="sidebar-link active flex items-center gap-3 px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="/disclosures" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" />
                        </svg>
                        <span>Disclosure Viewer</span>
                    </a>
                </li>
                <li>
                    <div>
                        <button onclick="toggleAdminMenu()" class="sidebar-link w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                            <div class="flex items-center gap-3">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <span>Admin</span>
                            </div>
                            <svg id="adminToggle" class="w-4 h-4 admin-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <ul id="adminSubmenu" class="admin-submenu ml-4 mt-2 space-y-1">
                            <li>
                                <a href="/api/docs" target="_blank" class="flex items-center gap-3 px-4 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-50 hover:text-conflixis-green transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                    <span>API Docs</span>
                                </a>
                            </li>
                            <li>
                                <a href="/api/redoc" target="_blank" class="flex items-center gap-3 px-4 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-50 hover:text-conflixis-green transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span>ReDoc</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            
            <div class="mt-8 pt-8 border-t">
                <h3 class="px-4 text-xs font-semibold text-gray-500 uppercase mb-3">Quick Stats</h3>
                <div class="px-4 space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Total Persons</span>
                        <span class="font-semibold">3,847</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Compliant</span>
                        <span class="font-semibold text-green-600">72.3%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Pending Review</span>
                        <span class="font-semibold text-conflixis-gold">712</span>
                    </div>
                </div>
            </div>
        </nav>
        
        <div class="absolute bottom-0 w-full p-4 border-t">
            <button onclick="toggleSidebar()" class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-conflixis-green transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                </svg>
                <span>Collapse Sidebar</span>
            </button>
        </div>
    </aside>
    
    <!-- Toggle Button (shown when sidebar is collapsed) -->
    <button id="sidebarToggle" onclick="toggleSidebar()" class="fixed left-0 top-20 z-40 p-2 bg-conflixis-green text-white rounded-r-lg shadow-lg hidden">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
    </button>
    
    <!-- Main Content -->
    <div id="mainContent" class="main-content flex-1 min-h-screen bg-conflixis-ivory">
        <!-- Top Navigation -->
        <nav class="bg-white shadow-lg sticky top-0 z-30">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <span class="text-xl font-soehneKraftig text-conflixis-green">Texas Health Resources</span>
                        <span class="text-sm block text-conflixis-green">COI Policy Compliance System</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Policy Version: 06/19/2025</span>
                        <button class="bg-conflixis-gold hover:bg-opacity-90 text-conflixis-green px-4 py-2 rounded-lg font-soehneKraftig transition-all">
                            Export Report
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    
    <!-- Summary Statistics and Compliance Overview -->
    <section class="py-6 animate-fade-in">
        <div class="container mx-auto px-6">
            <h1 class="text-3xl font-bold mb-6">COI Policy Compliance Dashboard</h1>
            
            <div class="grid lg:grid-cols-8 gap-6 mb-4">
                <!-- Left Column: Campaign Selection and Metrics -->
                <div class="lg:col-span-2 flex flex-col gap-4">
                    <!-- Campaign Selection Card -->
                    <div class="bg-white rounded-lg p-4 shadow">
                        <label class="text-sm font-soehneKraftig text-conflixis-green block mb-2">Campaign Filter</label>
                        <select id="campaignFilter" class="w-full text-xs border border-gray-300 rounded px-2 py-1.5 focus:outline-none focus:border-conflixis-green">
                            <option value="all">All Campaigns</option>
                            <option value="2025" selected>2025 Texas Health COI Survey - Leaders/Providers</option>
                            <option value="2024-workforce">2024 Texas Health COI Self-Identification Follow-Up - Workforce</option>
                            <option value="2024-leadership">2024 Texas Health COI Self-Identification Follow-Up - Leadership</option>
                            <option value="new-hires">New Hires Conflict of Interest Disclosure</option>
                            <option value="research">Conflict of Interest Disclosure (COI) - Research</option>
                        </select>
                    </div>
                    
                    <!-- Metrics Row: Total Covered Persons and Total Disclosures -->
                    <div class="grid grid-cols-2 gap-4 flex-1">
                        <!-- Total Covered Persons Card -->
                        <div class="bg-white rounded-lg p-4 shadow flex flex-col justify-center items-center text-center">
                            <h2 class="text-sm font-bold mb-2">Total Covered Persons</h2>
                            <div class="text-3xl font-soehneKraftig text-conflixis-blue bg-blue-100 rounded-lg px-6 py-2 mb-2" id="uniqueProvidersCount">0</div>
                            <div class="text-xs text-blue-600 font-medium">Unique providers</div>
                        </div>
                        
                        <!-- Total Disclosures Card -->
                        <div class="bg-white rounded-lg p-4 shadow flex flex-col justify-center items-center text-center">
                            <h2 class="text-sm font-bold mb-2">Total Disclosures</h2>
                            <div class="text-3xl font-soehneKraftig text-conflixis-green bg-conflixis-light-green rounded-lg px-6 py-2 mb-2" id="totalDisclosuresCount">0</div>
                            <div class="text-xs text-conflixis-mint font-medium">Submitted for campaign</div>
                        </div>
                    </div>
                </div>
                
                <!-- Compliance Status Breakdown -->
                <div class="lg:col-span-3 bg-white rounded-lg shadow p-6 flex flex-col h-full">
                    <h2 class="text-lg font-bold mb-4">Annual Disclosure Compliance Status</h2>
                    
                    <div class="flex-1 flex flex-col justify-center space-y-3">
                        <!-- Compliant -->
                        <div class="flex items-center gap-3">
                            <div class="w-24 text-xs font-soehneKraftig">Compliant</div>
                            <div class="flex-1 bg-gray-200 rounded-full h-6 relative overflow-hidden">
                                <div class="bg-conflixis-success-green h-6 rounded-full animate-bar" style="width: 72.3%; animation-delay: 0.1s;"></div>
                            </div>
                            <div class="w-24 text-right text-xs">2,781 (72.3%)</div>
                        </div>
                        
                        <!-- Pending Review -->
                        <div class="flex items-center gap-3">
                            <div class="w-24 text-xs font-soehneKraftig">Pending Review</div>
                            <div class="flex-1 bg-gray-200 rounded-full h-6 relative overflow-hidden">
                                <div class="bg-conflixis-gold h-6 rounded-full animate-bar" style="width: 18.5%; animation-delay: 0.2s;"></div>
                            </div>
                            <div class="w-24 text-right text-xs">712 (18.5%)</div>
                        </div>
                        
                        <!-- Overdue -->
                        <div class="flex items-center gap-3">
                            <div class="w-24 text-xs font-soehneKraftig">Overdue</div>
                            <div class="flex-1 bg-gray-200 rounded-full h-6 relative overflow-hidden">
                                <div class="bg-conflixis-red h-6 rounded-full animate-bar" style="width: 6.8%; animation-delay: 0.3s;"></div>
                            </div>
                            <div class="w-24 text-right text-xs">261 (6.8%)</div>
                        </div>
                        
                        <!-- Not Required -->
                        <div class="flex items-center gap-3">
                            <div class="w-24 text-xs font-soehneKraftig">Not Required</div>
                            <div class="flex-1 bg-gray-200 rounded-full h-6 relative overflow-hidden">
                                <div class="bg-gray-400 h-6 rounded-full animate-bar" style="width: 2.4%; animation-delay: 0.4s;"></div>
                            </div>
                            <div class="w-24 text-right text-xs">93 (2.4%)</div>
                        </div>
                    </div>
                </div>
                
                <!-- Covered Persons by Category Bar Chart -->
                <div class="lg:col-span-3 bg-white rounded-lg shadow p-6 flex flex-col h-full">
                    <h2 class="text-lg font-bold mb-4">Covered Persons by Category</h2>
                    
                    <div id="categoryChart" class="flex-1 flex flex-col justify-center">
                        <div class="space-y-3">
                            <!-- Categories will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Insurmountable Conflicts Section -->
    <section class="pb-6">
        <div class="container mx-auto px-6">
            <div class="mb-4 flex justify-between items-start">
                <div>
                    <h2 class="text-2xl font-bold text-conflixis-green">Insurmountable Conflicts Identified</h2>
                    <p class="text-sm text-gray-600 mt-1">Conflicts requiring immediate resolution or disqualification from board/committee positions</p>
                </div>
                <a href="/disclosures" 
                   class="bg-conflixis-blue hover:bg-opacity-90 text-white px-4 py-2 rounded-lg font-soehneKraftig transition-all text-sm">
                    View All Disclosures →
                </a>
            </div>
            <div class="bg-white rounded-lg shadow overflow-hidden">
                
                <div class="overflow-x-auto">
                    <table class="w-full" id="insurmountableConflictsTable">
                        <thead class="bg-conflixis-tan">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80 transition-colors">
                                    <div class="flex items-center gap-1">
                                        Person
                                        <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80 transition-colors">
                                    <div class="flex items-center gap-1">
                                        Position
                                        <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80 transition-colors">
                                    <div class="flex items-center gap-1">
                                        THR Entity
                                        <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80 transition-colors">
                                    <div class="flex items-center gap-1">
                                        Disclosure Category
                                        <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80 transition-colors">
                                    <div class="flex items-center gap-1">
                                        Status
                                        <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <!-- Sample Row 1 - Major Supplier -->
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="text-sm font-soehneKraftig">Robert Anderson</div>
                                    <div class="text-xs text-gray-500">randerson@example.com</div>
                                </td>
                                <td class="px-4 py-3 text-sm">Board Committee Candidate</td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs rounded-full bg-conflixis-red text-white">Major Supplier</span>
                                </td>
                                <td class="px-4 py-3 text-sm">
                                    <div class="flex items-center gap-2">
                                        <span>MedDevice Corp</span>
                                        <span class="px-2 py-0.5 text-xs rounded-full bg-conflixis-gray text-gray-700">Supplier Match</span>
                                    </div>
                                </td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Disqualified</span>
                                </td>
                                <td class="px-4 py-3">
                                    <button class="text-conflixis-blue hover:text-conflixis-green text-sm font-soehneKraftig inline-flex items-center gap-1">
                                        <span>Review</span>
                                        <span>→</span>
                                    </button>
                                </td>
                            </tr>
                            
                            <!-- Sample Row 2 - Competing Healthcare -->
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="text-sm font-soehneKraftig">Jennifer Martinez</div>
                                    <div class="text-xs text-gray-500">jmartinez@example.com</div>
                                </td>
                                <td class="px-4 py-3 text-sm">Medical Director</td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs rounded-full bg-conflixis-red text-white">Competing Healthcare</span>
                                </td>
                                <td class="px-4 py-3 text-sm">Regional Health System</td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Under Review</span>
                                </td>
                                <td class="px-4 py-3">
                                    <button class="text-conflixis-blue hover:text-conflixis-green text-sm font-soehneKraftig inline-flex items-center gap-1">
                                        <span>Review</span>
                                        <span>→</span>
                                    </button>
                                </td>
                            </tr>
                            
                            <!-- Sample Row 3 - Elected Official -->
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="text-sm font-soehneKraftig">Thomas Wilson</div>
                                    <div class="text-xs text-gray-500">twilson@example.com</div>
                                </td>
                                <td class="px-4 py-3 text-sm">Board Member Candidate</td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs rounded-full bg-conflixis-red text-white">Elected Official</span>
                                </td>
                                <td class="px-4 py-3 text-sm">State Legislature</td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Disqualified</span>
                                </td>
                                <td class="px-4 py-3">
                                    <button class="text-conflixis-blue hover:text-conflixis-green text-sm font-soehneKraftig inline-flex items-center gap-1">
                                        <span>Review</span>
                                        <span>→</span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
    
    
    <!-- Policy Requirements Overview -->
    <section class="pb-8">
        <div class="container mx-auto px-6">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">Policy Requirements & Timelines</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-soehneKraftig text-sm text-gray-700 mb-3">Disclosure Timelines</h3>
                        <div class="space-y-2">
                            <div class="flex items-start">
                                <div class="w-4 h-4 bg-conflixis-green rounded-full mt-0.5 flex-shrink-0"></div>
                                <div class="ml-3">
                                    <p class="text-sm font-soehneKraftig">Initial Disclosure</p>
                                    <p class="text-xs text-gray-600">Promptly upon becoming subject to policy</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="w-4 h-4 bg-conflixis-gold rounded-full mt-0.5 flex-shrink-0"></div>
                                <div class="ml-3">
                                    <p class="text-sm font-soehneKraftig">New Situation</p>
                                    <p class="text-xs text-gray-600">Immediately upon awareness</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="w-4 h-4 bg-conflixis-blue rounded-full mt-0.5 flex-shrink-0"></div>
                                <div class="ml-3">
                                    <p class="text-sm font-soehneKraftig">Annual Review</p>
                                    <p class="text-xs text-gray-600">At least annually</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-soehneKraftig text-sm text-gray-700 mb-3">Management Actions Required</h3>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between p-2 bg-conflixis-ivory rounded">
                                <span class="text-sm">Pending Initial Reviews</span>
                                <span class="text-sm font-soehneKraftig text-conflixis-red">47</span>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-conflixis-ivory rounded">
                                <span class="text-sm">Management Plans Due</span>
                                <span class="text-sm font-soehneKraftig text-conflixis-gold">23</span>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-conflixis-ivory rounded">
                                <span class="text-sm">Committee Reviews Scheduled</span>
                                <span class="text-sm font-soehneKraftig text-conflixis-blue">8</span>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-conflixis-ivory rounded">
                                <span class="text-sm">Resolutions Completed</span>
                                <span class="text-sm font-soehneKraftig text-conflixis-success-green">156</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h4 class="font-soehneKraftig text-sm text-gray-700 mb-3">Key Policy Thresholds</h4>
                    <div class="bg-conflixis-ivory rounded-lg p-4">
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <p class="text-xs text-gray-600">Financial Interest Threshold</p>
                                <p class="text-sm font-soehneKraftig text-conflixis-green">< 1% Public Securities</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-600">Review Authority</p>
                                <p class="text-sm font-soehneKraftig text-conflixis-green">Chief Compliance Officer</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-600">Approval Required</p>
                                <p class="text-sm font-soehneKraftig text-conflixis-green">Audit & Compliance Committee</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Individual COI Disclosure Detail Review -->
    <section class="pb-8">
        <div class="container mx-auto px-6">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">Sample COI Disclosure Detail Review</h2>
                
                <div class="border border-gray-200 rounded-lg p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-soehneKraftig">Dr. Michael Thompson</h3>
                            <p class="text-sm text-gray-600">Document ID: COI-2025-MT-0847</p>
                            <p class="text-sm text-gray-600">Campaign: 2025 Texas Health COI Survey - Leaders/Providers</p>
                            <p class="text-sm text-gray-600">Position: Medical Director, Cardiovascular Services</p>
                        </div>
                        <div class="text-right">
                            <span class="px-3 py-1 bg-conflixis-gold text-white rounded-full text-sm font-soehneKraftig">
                                Management Plan Required
                            </span>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-soehneKraftig text-sm text-gray-700 mb-2">Disclosed Interests</h4>
                            <dl class="space-y-2">
                                <div class="flex">
                                    <dt class="text-sm text-gray-600 w-32">Financial Interest:</dt>
                                    <dd class="text-sm font-soehneKraftig">2.5% Ownership - CardioTech Solutions</dd>
                                </div>
                                <div class="flex">
                                    <dt class="text-sm text-gray-600 w-32">Governance Role:</dt>
                                    <dd class="text-sm font-soehneKraftig">Board Member - Regional Heart Foundation</dd>
                                </div>
                                <div class="flex">
                                    <dt class="text-sm text-gray-600 w-32">Compensation:</dt>
                                    <dd class="text-sm font-soehneKraftig text-conflixis-gold">$45,000 annually</dd>
                                </div>
                                <div class="flex">
                                    <dt class="text-sm text-gray-600 w-32">Service Period:</dt>
                                    <dd class="text-sm">01/2024 - Present</dd>
                                </div>
                                <div class="flex">
                                    <dt class="text-sm text-gray-600 w-32">Family Member:</dt>
                                    <dd class="text-sm">
                                        <span class="px-2 py-0.5 text-xs rounded-full bg-conflixis-blue text-white">Spouse - Vendor Relationship</span>
                                    </dd>
                                </div>
                            </dl>
                        </div>
                        
                        <div>
                            <h4 class="font-soehneKraftig text-sm text-gray-700 mb-2">Policy Compliance Assessment</h4>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <span class="w-4 h-4 bg-conflixis-success-green rounded-full mr-2"></span>
                                    <span class="text-sm">Annual disclosure submitted on time</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-4 h-4 bg-conflixis-gold rounded-full mr-2"></span>
                                    <span class="text-sm">Financial interest exceeds 1% threshold</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-4 h-4 bg-conflixis-gold rounded-full mr-2"></span>
                                    <span class="text-sm">Governance relationship disclosed</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-4 h-4 bg-conflixis-blue rounded-full mr-2"></span>
                                    <span class="text-sm">Family member vendor relationship</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-4 h-4 bg-conflixis-success-green rounded-full mr-2"></span>
                                    <span class="text-sm">Not an insurmountable conflict</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-soehneKraftig text-sm text-gray-700 mb-2">Management Plan Requirements</h4>
                        <ol class="list-decimal list-inside space-y-1 text-sm text-gray-600">
                            <li>Recusal from all purchasing decisions related to cardiovascular equipment and supplies</li>
                            <li>Cannot participate in vendor selection committees for cardiology services</li>
                            <li>Disclosure required in all research publications and presentations</li>
                            <li>Quarterly reporting of any changes in ownership percentage or compensation</li>
                            <li>Annual review by Audit and Compliance Committee</li>
                        </ol>
                    </div>
                    
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-soehneKraftig text-sm text-gray-700 mb-3">Compliance Officer Review & Recommendations</h4>
                        <div class="bg-conflixis-ivory rounded-lg p-4 space-y-3">
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-conflixis-gold rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                    <span class="text-white text-xs font-bold">!</span>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-soehneKraftig text-conflixis-green">Manageable Conflict Identified</p>
                                    <p class="text-sm text-gray-600 mt-1">
                                        Dr. Thompson's 2.5% ownership in CardioTech Solutions exceeds the 1% threshold for publicly traded securities 
                                        exemption. Combined with his governance role and spouse's vendor relationship, this creates a conflict requiring 
                                        active management but does not rise to an insurmountable level.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-conflixis-blue rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                    <span class="text-white text-xs font-bold">✓</span>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-soehneKraftig text-conflixis-green">Recommended Actions</p>
                                    <ul class="text-sm text-gray-600 mt-1 list-disc list-inside space-y-1">
                                        <li>Approve continuation in Medical Director role with management plan</li>
                                        <li>Implement automated monitoring for CardioTech Solutions contracts</li>
                                        <li>Require spouse's vendor activities be disclosed separately</li>
                                        <li>Document all recusals in committee meeting minutes</li>
                                        <li>Schedule management plan review for Q2 2025</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-conflixis-green rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                    <span class="text-white text-xs font-bold">📋</span>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-soehneKraftig text-conflixis-green">Documentation Requirements</p>
                                    <p class="text-sm text-gray-600 mt-1">
                                        Per Section 4.11 of the COI Policy, all committee meeting minutes must document Dr. Thompson's recusal from 
                                        relevant discussions. The management plan must be reviewed by the Audit and Compliance Committee and 
                                        individual entity reports provided to the Board Chair and Entity Triads.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 border-l-4 border-conflixis-gold p-3 mt-4">
                                <p class="text-sm text-gray-700">
                                    <span class="font-soehneKraftig">Next Steps:</span> Management plan to be presented to Audit and Compliance 
                                    Committee at next meeting (July 15, 2025). Dr. Thompson must acknowledge plan requirements in writing within 
                                    10 business days.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-soehneKraftig text-sm text-gray-700 mb-2">Review History</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                <div class="flex items-center">
                                    <span class="w-2 h-2 bg-conflixis-green rounded-full mr-2"></span>
                                    <span class="text-sm">Initial disclosure submitted</span>
                                </div>
                                <span class="text-xs text-gray-500">June 28, 2025 - 9:15 AM</span>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                <div class="flex items-center">
                                    <span class="w-2 h-2 bg-conflixis-blue rounded-full mr-2"></span>
                                    <span class="text-sm">Chief Compliance Officer review initiated</span>
                                </div>
                                <span class="text-xs text-gray-500">June 29, 2025 - 2:30 PM</span>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                <div class="flex items-center">
                                    <span class="w-2 h-2 bg-conflixis-gold rounded-full mr-2"></span>
                                    <span class="text-sm">Management plan drafted</span>
                                </div>
                                <span class="text-xs text-gray-500">July 2, 2025 - 11:00 AM</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">
                            Download Documentation
                        </button>
                        <button class="px-4 py-2 bg-conflixis-gold text-conflixis-green rounded-lg text-sm font-soehneKraftig hover:bg-opacity-90">
                            Send for Committee Review
                        </button>
                        <button class="px-4 py-2 bg-conflixis-green text-white rounded-lg text-sm font-soehneKraftig hover:bg-opacity-90">
                            Approve Management Plan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="bg-conflixis-green text-white py-6">
        <div class="container mx-auto px-6 text-center">
            <p class="text-sm">Texas Health Resources COI Policy Compliance System</p>
            <p class="text-xs mt-1 text-conflixis-light-green">Powered by Conflixis Analytics Platform</p>
        </div>
    </footer>
    </div> <!-- End of Main Content -->
    
    <!-- API Client -->
    <script src="api.js"></script>
    
    <script>
        // Initialize API client
        const apiClient = new DisclosureAPIClient();
        
        // Store all disclosure data
        let allDisclosures = [];
        let currentCampaignFilter = '2025'; // Default to 2025 campaign
        
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.getElementById('sidebarToggle');
            
            sidebar.classList.toggle('sidebar-collapsed');
            mainContent.classList.toggle('main-content-expanded');
            toggleBtn.classList.toggle('hidden');
        }
        
        // Toggle admin submenu
        function toggleAdminMenu() {
            const submenu = document.getElementById('adminSubmenu');
            const toggle = document.getElementById('adminToggle');
            
            submenu.classList.toggle('expanded');
            toggle.classList.toggle('rotated');
        }
        
        // Load real data from API
        async function loadDashboardData() {
            try {
                // Check if API is available
                const health = await apiClient.healthCheck();
                
                if (!health.data_loaded) {
                    console.error('API has no data loaded');
                    showErrorMessage();
                    return;
                }
                
                // Load all disclosures (paginated)
                allDisclosures = [];
                let page = 1;
                const pageSize = 100;
                let totalPages = 1;
                
                while (page <= totalPages) {
                    const response = await apiClient.getDisclosures({ 
                        page: page, 
                        page_size: pageSize 
                    });
                    
                    allDisclosures = allDisclosures.concat(response.data);
                    totalPages = response.pages || Math.ceil(response.total / pageSize);
                    page++;
                }
                
                console.log(`Loaded ${allDisclosures.length} total disclosures`);
                
                // Update all sections with real data
                updateComplianceStatus();
                updateInsurmountableConflicts();
                updateCoveredPersonsByCategory();
                updateCategoryBarChart();
                updateSidebarStats();
                
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                showErrorMessage();
            }
        }
        
        // Update compliance status section with real data
        function updateComplianceStatus() {
            // Filter by campaign
            let filteredData = allDisclosures;
            
            // Since we only have 2025 data, show data only for 2025 or all campaigns
            if (currentCampaignFilter === '2025' || currentCampaignFilter === 'all') {
                // Show all data (which is 2025 data)
                filteredData = allDisclosures;
            } else {
                // For any other campaign, show empty data
                filteredData = [];
            }
            
            // Calculate real statistics
            const totalDisclosures = filteredData.length;
            const uniqueProviders = new Set(filteredData.map(d => d.provider_name)).size;
            
            // Count by review status
            const statusCounts = {
                approved: filteredData.filter(d => d.review_status === 'approved').length,
                pending: filteredData.filter(d => d.review_status === 'pending').length,
                in_review: filteredData.filter(d => d.review_status === 'in_review').length,
                requires_management: filteredData.filter(d => d.review_status === 'requires_management').length
            };
            
            // Calculate percentages
            const compliantCount = statusCounts.approved;
            const pendingCount = statusCounts.pending + statusCounts.in_review;
            const overdueCount = statusCounts.requires_management;
            const notRequiredCount = 0; // We don't have this data
            
            const compliantPercent = totalDisclosures > 0 ? (compliantCount / totalDisclosures * 100).toFixed(1) : 0;
            const pendingPercent = totalDisclosures > 0 ? (pendingCount / totalDisclosures * 100).toFixed(1) : 0;
            const overduePercent = totalDisclosures > 0 ? (overdueCount / totalDisclosures * 100).toFixed(1) : 0;
            
            // Update Total Disclosures and Total Covered Persons
            document.getElementById('totalDisclosuresCount').textContent = totalDisclosures.toLocaleString();
            document.getElementById('uniqueProvidersCount').textContent = uniqueProviders.toLocaleString();
            
            // Update compliance bars and counts
            const complianceSection = document.querySelector('.lg\\:col-span-2');
            if (complianceSection) {
                // Update Compliant bar
                const compliantBar = complianceSection.querySelector('.bg-conflixis-success-green');
                if (compliantBar) {
                    compliantBar.style.width = `${compliantPercent}%`;
                    const compliantRow = compliantBar.closest('.flex');
                    const compliantCount = compliantRow.querySelector('.w-24.text-right');
                    compliantCount.textContent = `${statusCounts.approved.toLocaleString()} (${compliantPercent}%)`;
                }
                
                // Update Pending Review bar
                const pendingBar = complianceSection.querySelector('.bg-conflixis-gold');
                if (pendingBar) {
                    pendingBar.style.width = `${pendingPercent}%`;
                    const pendingRow = pendingBar.closest('.flex');
                    const pendingCountEl = pendingRow.querySelector('.w-24.text-right');
                    pendingCountEl.textContent = `${pendingCount.toLocaleString()} (${pendingPercent}%)`;
                }
                
                // Update Overdue bar
                const overdueBar = complianceSection.querySelector('.bg-conflixis-red');
                if (overdueBar) {
                    overdueBar.style.width = `${overduePercent}%`;
                    const overdueRow = overdueBar.closest('.flex');
                    const overdueCountEl = overdueRow.querySelector('.w-24.text-right');
                    overdueCountEl.textContent = `${overdueCount.toLocaleString()} (${overduePercent}%)`;
                }
            }
        }
        
        // Update insurmountable conflicts table with real critical risk disclosures
        function updateInsurmountableConflicts() {
            // Filter by campaign first
            let filteredData = allDisclosures;
            if (currentCampaignFilter === '2025' || currentCampaignFilter === 'all') {
                filteredData = allDisclosures;
            } else {
                filteredData = [];
            }
            
            // Get critical risk disclosures
            const criticalDisclosures = filteredData
                .filter(d => d.risk_tier === 'critical')
                .slice(0, 10); // Show top 10
            
            const tbody = document.querySelector('#insurmountableConflictsTable tbody');
            if (!tbody) {
                // Add ID to the table for easier access
                const table = document.querySelector('section:nth-of-type(2) table');
                if (table) {
                    table.id = 'insurmountableConflictsTable';
                    return updateInsurmountableConflicts(); // Retry with ID set
                }
                return;
            }
            
            tbody.innerHTML = '';
            
            if (criticalDisclosures.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                            No critical risk conflicts identified
                        </td>
                    </tr>
                `;
                return;
            }
            
            criticalDisclosures.forEach(disclosure => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => showDetails(disclosure);
                
                row.innerHTML = `
                    <td class="px-4 py-3">
                        <div class="text-sm font-soehneKraftig">${disclosure.provider_name}</div>
                        <div class="text-xs text-gray-500">${disclosure.provider_npi || 'No NPI'}</div>
                    </td>
                    <td class="px-4 py-3 text-sm">${disclosure.job_title || 'Not Specified'}</td>
                    <td class="px-4 py-3 text-sm">
                        ${disclosure.entity_name || 'N/A'}
                    </td>
                    <td class="px-4 py-3 text-sm">
                        ${disclosure.category_label || 'Unknown Category'}
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 text-xs rounded-full ${
                            disclosure.review_status === 'requires_management' ? 'bg-red-100 text-red-800' :
                            disclosure.review_status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-gray-100 text-gray-800'
                        }">
                            ${disclosure.review_status.replace('_', ' ').charAt(0).toUpperCase() + 
                              disclosure.review_status.slice(1).replace('_', ' ')}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update covered persons by category
        function updateCoveredPersonsByCategory() {
            // Filter by campaign first
            let filteredData = allDisclosures;
            if (currentCampaignFilter === '2025' || currentCampaignFilter === 'all') {
                filteredData = allDisclosures;
            } else {
                filteredData = [];
            }
            
            // Group disclosures by job title/category
            const categories = {};
            
            filteredData.forEach(disclosure => {
                const category = getCategoryFromJobTitle(disclosure.job_title || 'Other');
                if (!categories[category]) {
                    categories[category] = {
                        total: 0,
                        compliant: 0,
                        pending: 0
                    };
                }
                categories[category].total++;
                
                if (disclosure.review_status === 'approved') {
                    categories[category].compliant++;
                } else if (disclosure.review_status === 'pending' || disclosure.review_status === 'in_review') {
                    categories[category].pending++;
                }
            });
            
            // Update the display for main categories
            updateCategoryCard('Board Members', categories['Board Members'] || {total: 0, compliant: 0, pending: 0});
            updateCategoryCard('Officers', categories['Officers'] || {total: 0, compliant: 0, pending: 0});
            updateCategoryCard('Medical Directors', categories['Medical Directors'] || {total: 0, compliant: 0, pending: 0});
            updateCategoryCard('Contracted Physicians', categories['Physicians'] || {total: 0, compliant: 0, pending: 0});
        }
        
        // Helper function to categorize job titles
        function getCategoryFromJobTitle(jobTitle) {
            const title = jobTitle.toLowerCase();
            if (title.includes('board') || title.includes('trustee')) return 'Board Members';
            if (title.includes('officer') || title.includes('chief') || title.includes('ceo') || 
                title.includes('cfo') || title.includes('coo')) return 'Officers';
            if (title.includes('medical director') || title.includes('director')) return 'Medical Directors';
            if (title.includes('physician') || title.includes('doctor') || title.includes('md')) return 'Physicians';
            return 'Other';
        }
        
        // Update Covered Persons by Category Bar Chart
        function updateCategoryBarChart() {
            const chartContainer = document.querySelector('#categoryChart .space-y-3');
            if (!chartContainer) return;
            
            // Calculate person counts by seniority level
            const seniorityCategories = {
                'Board Members': 0,
                'Officers': 0,
                'Medical Directors': 0,
                'Department Chairs': 0,
                'Contracted Physicians': 0,
                'Other Staff': 0
            };
            
            // Count unique providers by job title category
            const uniqueProvidersByTitle = {};
            allDisclosures.forEach(disclosure => {
                const provider = disclosure.provider_name;
                const title = (disclosure.job_title || '').toLowerCase();
                
                // Categorize by job title
                let category = 'Other Staff';
                if (title.includes('board') || title.includes('trustee')) {
                    category = 'Board Members';
                } else if (title.includes('chief') || title.includes('officer') || title.includes('ceo') || 
                          title.includes('cfo') || title.includes('coo') || title.includes('president') || 
                          title.includes('vp') || title.includes('vice president')) {
                    category = 'Officers';
                } else if (title.includes('medical director') || title.includes('med director') || 
                          title.includes('clinical director')) {
                    category = 'Medical Directors';
                } else if (title.includes('chair') || title.includes('department head')) {
                    category = 'Department Chairs';
                } else if (title.includes('physician') || title.includes('doctor') || 
                          title.includes('md') || title.includes('surgeon')) {
                    category = 'Contracted Physicians';
                }
                
                // Track unique providers per category
                if (!uniqueProvidersByTitle[category]) {
                    uniqueProvidersByTitle[category] = new Set();
                }
                uniqueProvidersByTitle[category].add(provider);
            });
            
            // Convert sets to counts
            Object.keys(seniorityCategories).forEach(category => {
                if (uniqueProvidersByTitle[category]) {
                    seniorityCategories[category] = uniqueProvidersByTitle[category].size;
                }
            });
            
            // Sort categories by predefined order (most senior first)
            const sortedCategories = Object.entries(seniorityCategories)
                .filter(([_, count]) => count > 0); // Only show categories with people
            
            // Calculate total for percentages
            const totalPersons = Object.values(seniorityCategories).reduce((sum, count) => sum + count, 0);
            
            // Find max count for scaling bars
            const maxCount = Math.max(...Object.values(seniorityCategories));
            
            // Clear existing content
            chartContainer.innerHTML = '';
            
            // Create bar chart
            sortedCategories.forEach(([category, count], index) => {
                const barWidth = maxCount > 0 ? (count / maxCount * 100) : 0;
                const percentage = totalPersons > 0 ? (count / totalPersons * 100) : 0;
                
                const categoryColors = {
                    'Board Members': 'bg-conflixis-green',
                    'Officers': 'bg-conflixis-blue',
                    'Medical Directors': 'bg-purple-500',
                    'Department Chairs': 'bg-yellow-500',
                    'Contracted Physicians': 'bg-teal-500',
                    'Other Staff': 'bg-gray-500'
                };
                
                const color = categoryColors[category] || 'bg-gray-500';
                
                const bar = document.createElement('div');
                bar.className = 'flex items-center gap-3';
                bar.innerHTML = `
                    <div class="w-32 text-xs font-soehneKraftig truncate" title="${category}">${category}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-6 relative overflow-hidden">
                        <div class="${color} h-6 rounded-full animate-bar" style="width: ${barWidth}%; animation-delay: ${index * 0.1}s;"></div>
                    </div>
                    <div class="w-24 text-right text-xs">${count} (${percentage.toFixed(1)}%)</div>
                `;
                chartContainer.appendChild(bar);
            });
            
            // Add a note if there are no categories
            if (sortedCategories.length === 0) {
                chartContainer.innerHTML = '<p class="text-sm text-gray-500 text-center">No data available</p>';
            }
        }
        
        // Update individual category card
        function updateCategoryCard(categoryName, data) {
            const cards = document.querySelectorAll('.border.border-gray-200.rounded-lg.p-4');
            cards.forEach(card => {
                const titleDiv = card.querySelector('.text-sm.text-gray-600');
                if (titleDiv && titleDiv.textContent.includes(categoryName)) {
                    // Update total count
                    const countDiv = card.querySelector('.text-2xl.font-soehneKraftig.text-conflixis-green');
                    if (countDiv) {
                        countDiv.textContent = data.total.toLocaleString();
                    }
                    
                    // Update compliant/pending counts
                    const statusDiv = card.querySelector('.flex.justify-between.text-xs');
                    if (statusDiv) {
                        statusDiv.innerHTML = `
                            <span class="text-conflixis-success-green">✓ ${data.compliant} Compliant</span>
                            <span class="text-conflixis-red">${data.pending} Pending</span>
                        `;
                    }
                }
            });
        }
        
        // Update sidebar statistics
        function updateSidebarStats() {
            const totalDisclosures = allDisclosures.length;
            const uniqueProviders = new Set(allDisclosures.map(d => d.provider_name)).size;
            const compliantCount = allDisclosures.filter(d => d.review_status === 'approved').length;
            const pendingCount = allDisclosures.filter(d => 
                d.review_status === 'pending' || d.review_status === 'in_review'
            ).length;
            
            const compliantPercent = totalDisclosures > 0 ? 
                (compliantCount / totalDisclosures * 100).toFixed(1) : 0;
            
            // Update sidebar stats
            const sidebarStats = document.querySelector('.sidebar .border-t');
            if (sidebarStats) {
                const statsContainer = sidebarStats.nextElementSibling;
                if (statsContainer) {
                    statsContainer.innerHTML = `
                        <h3 class="px-4 text-xs font-semibold text-gray-500 uppercase mb-3">Quick Stats</h3>
                        <div class="px-4 space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total Disclosures</span>
                                <span class="font-semibold">${totalDisclosures.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Unique Providers</span>
                                <span class="font-semibold">${uniqueProviders.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Compliant</span>
                                <span class="font-semibold text-green-600">${compliantPercent}%</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Pending Review</span>
                                <span class="font-semibold text-conflixis-gold">${pendingCount.toLocaleString()}</span>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        // Show error message
        function showErrorMessage() {
            const complianceSection = document.querySelector('.lg\\:col-span-2');
            if (complianceSection) {
                complianceSection.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                        <h3 class="text-lg font-bold text-red-700 mb-2">Unable to Load Data</h3>
                        <p class="text-sm text-red-600">
                            Please ensure the API server is running and data has been fetched from BigQuery.
                        </p>
                        <p class="text-xs text-gray-600 mt-2">
                            Run: <code class="bg-gray-100 px-2 py-1 rounded">python scripts/fetch_json_data.py</code>
                        </p>
                    </div>
                `;
            }
        }
        
        // Handle campaign filter change
        function handleCampaignChange(event) {
            currentCampaignFilter = event.target.value;
            updateComplianceStatus();
            updateInsurmountableConflicts();
            updateCoveredPersonsByCategory();
            updateCategoryBarChart();
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            
            // Add campaign filter listener
            const campaignSelect = document.getElementById('campaignFilter');
            if (campaignSelect) {
                campaignSelect.addEventListener('change', handleCampaignChange);
            }
        });
        
        // Show details modal with proper form based on category/type
        function showDetails(record) {
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('modalContent');
            const modalTitle = document.querySelector('#detailModal h3');
            
            // Update modal title to show category and type  
            modalTitle.innerHTML = `${record.category_label || 'Disclosure'} - ${record.relationship_type || 'Details'}`;
            
            const riskColor = {
                low: 'text-green-600 bg-green-50',
                moderate: 'text-yellow-600 bg-yellow-50', 
                high: 'text-orange-600 bg-orange-50',
                critical: 'text-red-600 bg-red-50'
            }[record.risk_tier] || 'text-gray-600 bg-gray-50';
            
            // Get the appropriate form content
            let formContent = getFormContent(record);
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Category Badge and Overview -->
                    <div class="flex items-center justify-between border-b pb-4">
                        <div>
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold mr-2
                                ${getCategoryColor(record.category_label)}">
                                ${record.category_label}
                            </span>
                            <span class="text-sm text-gray-600">${record.relationship_type}</span>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-3 py-1 rounded-lg text-xs font-semibold ${riskColor}">
                                ${record.risk_tier.toUpperCase()} RISK
                            </span>
                        </div>
                    </div>
                    
                    <!-- Provider Information Card -->
                    <div class="bg-gradient-to-r from-conflixis-green to-teal-700 text-white rounded-lg p-4">
                        <div class="flex items-start justify-between">
                            <div>
                                <h4 class="text-lg font-bold">${record.provider_name}</h4>
                                <p class="text-sm opacity-90">${record.job_title || 'Not Specified'}</p>
                                <p class="text-sm opacity-90">${record.department || 'Healthcare'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs opacity-75">NPI</p>
                                <p class="font-mono text-sm">${record.provider_npi || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dynamic Form Content -->
                    <div>
                        <h4 class="text-sm font-semibold text-gray-500 mb-3">Disclosure Form</h4>
                        ${formContent}
                    </div>
                    
                    <!-- Financial Summary -->
                    <div class="bg-gradient-to-r from-conflixis-gold to-yellow-400 text-white rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs opacity-90 uppercase">Total Disclosed Amount</p>
                                <p class="text-3xl font-bold">
                                    ${record.financial_amount === null || record.financial_amount === undefined ? 
                                        'N/A' : 
                                        record.financial_amount === 0 ? 
                                            '$-' : 
                                            '$' + record.financial_amount.toLocaleString()}
                                </p>
                            </div>
                            ${record.open_payments_total > 0 ? `
                            <div class="text-right">
                                <p class="text-xs opacity-90">Open Payments Match</p>
                                <p class="text-lg font-semibold">$${record.open_payments_total.toLocaleString()}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Management Actions -->
                    <div>
                        <h4 class="text-sm font-semibold text-gray-500 mb-3">Management & Review</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="border-l-4 border-conflixis-blue pl-3">
                                    <span class="text-xs text-gray-500">Review Status</span>
                                    <p class="font-semibold capitalize">${record.review_status.replace('_', ' ')}</p>
                                </div>
                                <div class="border-l-4 ${record.management_plan_required ? 'border-red-500' : 'border-green-500'} pl-3">
                                    <span class="text-xs text-gray-500">Management Plan</span>
                                    <p class="font-semibold">${record.management_plan_required ? 'Required' : 'Not Required'}</p>
                                </div>
                                <div class="border-l-4 border-gray-400 pl-3">
                                    <span class="text-xs text-gray-500">Last Review</span>
                                    <p class="font-semibold">${record.last_review_date}</p>
                                </div>
                                <div class="border-l-4 border-purple-500 pl-3">
                                    <span class="text-xs text-gray-500">Next Review</span>
                                    <p class="font-semibold">${record.next_review_date}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Policy Guidance (System-generated) -->
                    ${getPolicyNote(record.category_label, record.relationship_type) ? `
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-semibold text-sm mb-2 text-blue-700">Policy Guidance</h5>
                        <p class="text-sm text-gray-700">${getPolicyNote(record.category_label, record.relationship_type)}</p>
                    </div>
                    ` : ''}
                    
                    <!-- Document Info Footer -->
                    <div class="border-t pt-4 flex justify-between items-center text-xs text-gray-500">
                        <div>
                            <span>Document ID: </span>
                            <span class="font-mono">${record.id}</span>
                        </div>
                        <div>
                            <span>Disclosed: </span>
                            <span>${record.disclosure_date}</span>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Get category color classes
        function getCategoryColor(category) {
            const colors = {
                'External Roles & Relationships': 'bg-blue-100 text-blue-700',
                'Financial & Investment Interests': 'bg-yellow-100 text-yellow-700',
                'Open Payments (CMS Imports)': 'bg-green-100 text-green-700',
                'Political & Charitable Activities': 'bg-purple-100 text-purple-700',
                'Legal & Compliance Matters': 'bg-red-100 text-red-700'
            };
            return colors[category] || 'bg-gray-100 text-gray-700';
        }
        
        // Get form content based on category and type
        function getFormContent(record) {
            const category = record.category_label;
            const type = record.relationship_type;
            
            // External Roles & Relationships Forms
            if (category === 'External Roles & Relationships') {
                if (type === 'Related Parties') {
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Related Person Name</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name || 'Not Specified'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Relationship Type</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Family Member</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Related Person's Entity</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.department || 'Texas Health'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Related Person's Job Title</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.job_title || 'Not Specified'}</p>
                                    </div>
                                </div>
                                ${record.notes ? `
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Default form for unmatched types
            return `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Entity Name</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Disclosure Type</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded">${record.relationship_type}</p>
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Financial Amount</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded font-semibold">
                                    ${record.financial_amount !== null && record.financial_amount !== undefined ? 
                                        '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                </p>
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Status</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded">${record.review_status}</p>
                            </div>
                        </div>
                        ${record.notes ? `
                        <div>
                            <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                            <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Get policy note based on category and type
        function getPolicyNote(category, type) {
            if (category === 'External Roles & Relationships') {
                if (type === 'Related Parties') {
                    return 'Family relationships within the organization must be disclosed to ensure appropriate management of potential conflicts.';
                }
            } else if (category === 'Financial & Investment Interests') {
                return 'Financial interests in vendors, competitors, or related entities require disclosure and may need management plans.';
            } else if (category === 'Open Payments (CMS Imports)') {
                return 'CMS Open Payments data is automatically imported to ensure transparency and compliance with federal reporting requirements.';
            }
            return null;
        }

        // Close modal
        function closeModal() {
            document.getElementById('detailModal').classList.add('hidden');
        }
    </script>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop fixed inset-0 bg-black bg-opacity-50" onclick="closeModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto relative">
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-start">
                    <h3 class="text-2xl font-bold text-conflixis-green">Disclosure Details</h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="modalContent" class="p-6">
                    <!-- Modal content will be inserted here -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>