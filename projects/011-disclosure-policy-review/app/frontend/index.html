<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disclosure Data Viewer - COI Compliance System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configure Tailwind with Conflixis colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'conflixis-green': '#0c343a',
                        'conflixis-light-green': '#93baab',
                        'conflixis-white': '#ffffff',
                        'conflixis-gray': '#d1d5db',
                        'conflixis-gray-hover': '#b9bec4',
                        'conflixis-ivory': '#f8f5ef',
                        'conflixis-tan': '#c5bdae',
                        'conflixis-mint': '#93baab',
                        'conflixis-gold': '#eab96d',
                        'conflixis-blue': '#4c94ed',
                        'conflixis-red': '#fd7649',
                        'conflixis-success-green': '#008000FF',
                    },
                    fontFamily: {
                        'soehneLeicht': ['SoehneLeicht', 'sans-serif'],
                        'soehneKraftig': ['SoehneKraftig', 'sans-serif'],
                        'ivarDisplay': ['IvarDisplay', 'serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts -->
    <style>
        @font-face {
            font-family: 'SoehneLeicht';
            src: url('../../docs/design-system/conflixis-design-system/assets/fonts/soehne-leicht.woff2') format('woff2');
            font-weight: 300;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'SoehneKraftig';
            src: url('../../docs/design-system/conflixis-design-system/assets/fonts/soehne-kraftig.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'IvarDisplay';
            src: url('../../docs/design-system/conflixis-design-system/assets/fonts/IvarDisplay-Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }
        
        body {
            font-family: 'SoehneLeicht', sans-serif;
            background-color: #f8f5ef;
            color: #0c343a;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'IvarDisplay', serif;
            color: #0c343a;
        }
        
        /* Animations */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fade-in 0.6s ease-out forwards;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #93baab;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #0c343a;
        }
        
        /* Modal backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
    <style>
        /* Sidebar styles */
        .sidebar {
            width: 250px;
            transition: transform 0.3s ease;
        }
        
        .sidebar-collapsed {
            transform: translateX(-250px);
        }
        
        .main-content {
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }
        
        .main-content-expanded {
            margin-left: 0;
        }
        
        .sidebar-link {
            transition: all 0.2s ease;
        }
        
        .sidebar-link:hover {
            background-color: rgba(12, 52, 58, 0.1);
            padding-left: 1.25rem;
        }
        
        .sidebar-link.active {
            background-color: #0c343a;
            color: white;
        }
        
        .admin-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .admin-submenu.expanded {
            max-height: 200px;
        }
        
        .admin-toggle {
            transition: transform 0.3s ease;
        }
        
        .admin-toggle.rotated {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed h-full bg-white shadow-lg z-50">
        <div class="p-6 border-b">
            <div class="flex items-center space-x-3">
                <img src="../../docs/design-system/conflixis-design-system/assets/logos/conflixis-logo.png" 
                     alt="Conflixis" class="h-10 w-10">
                <div>
                    <h2 class="text-lg font-soehneKraftig text-conflixis-green">Disclosure Review</h2>
                    <p class="text-xs text-gray-600">Conflixis</p>
                </div>
            </div>
        </div>
        
        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="/" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="/disclosures" class="sidebar-link active flex items-center gap-3 px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" />
                        </svg>
                        <span>Disclosure Viewer</span>
                    </a>
                </li>
                <li>
                    <div>
                        <button onclick="toggleAdminMenu()" class="sidebar-link w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                            <div class="flex items-center gap-3">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <span>Admin</span>
                            </div>
                            <svg id="adminToggle" class="w-4 h-4 admin-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <ul id="adminSubmenu" class="admin-submenu ml-4 mt-2 space-y-1">
                            <li>
                                <a href="/api/docs" target="_blank" class="flex items-center gap-3 px-4 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-50 hover:text-conflixis-green transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                    <span>API Docs</span>
                                </a>
                            </li>
                            <li>
                                <a href="/api/redoc" target="_blank" class="flex items-center gap-3 px-4 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-50 hover:text-conflixis-green transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span>ReDoc</span>
                                </a>
                            </li>
                            <li>
                                <a href="/forms-showcase" target="_blank" class="flex items-center gap-3 px-4 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-50 hover:text-conflixis-green transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                    </svg>
                                    <span>Forms Showcase</span>
                                </a>
                            </li>
                            <li>
                                <a href="/configuration" class="flex items-center gap-3 px-4 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-50 hover:text-conflixis-green transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                    </svg>
                                    <span>Configuration</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            
            <div class="mt-8 pt-8 border-t">
                <h3 class="px-4 text-xs font-semibold text-gray-500 uppercase mb-3">Quick Stats</h3>
                <div class="px-4 space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Total Records</span>
                        <span class="font-semibold" id="sidebarTotalCount">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Pending Review</span>
                        <span class="font-semibold text-conflixis-blue" id="sidebarPendingCount">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Critical Risk</span>
                        <span class="font-semibold text-red-600" id="sidebarCriticalCount">0</span>
                    </div>
                </div>
            </div>
        </nav>
        
        <div class="absolute bottom-0 w-full p-4 border-t">
            <button onclick="toggleSidebar()" class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-conflixis-green transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                </svg>
                <span>Collapse Sidebar</span>
            </button>
        </div>
    </aside>
    
    <!-- Toggle Button (shown when sidebar is collapsed) -->
    <button id="sidebarToggle" onclick="toggleSidebar()" class="fixed left-0 top-20 z-40 p-2 bg-conflixis-green text-white rounded-r-lg shadow-lg hidden">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
    </button>
    
    <!-- Main Content -->
    <div id="mainContent" class="main-content flex-1 min-h-screen bg-conflixis-ivory">
        <!-- Top Navigation -->
        <nav class="bg-white shadow-lg sticky top-0 z-30">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-soehneKraftig text-conflixis-green">Disclosure Viewer</h1>
                        <p class="text-xs text-gray-600">Detailed Provider Disclosure Records</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="exportData()" 
                                class="px-4 py-2 border border-conflixis-green text-conflixis-green rounded-lg hover:bg-conflixis-green hover:text-white transition-all">
                            Export Data
                        </button>
                    </div>
                </div>
            </div>
        </nav>

    <!-- Filters Section -->
    <section class="py-6">
        <div class="container mx-auto px-6">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex flex-wrap gap-4 items-end">
                    <!-- Search -->
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-soehneKraftig text-gray-700 mb-1">Search Provider</label>
                        <input type="text" 
                               id="searchInput"
                               placeholder="Name, Category, Type, or Entity..."
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-conflixis-green">
                    </div>
                    
                    <!-- Risk Tier Filter -->
                    <div class="min-w-[150px]">
                        <label class="block text-sm font-soehneKraftig text-gray-700 mb-1">Risk Tier</label>
                        <select id="riskFilter" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-conflixis-green">
                            <option value="">All Tiers</option>
                            <option value="low">Low Risk</option>
                            <option value="moderate">Moderate Risk</option>
                            <option value="high">High Risk</option>
                            <option value="critical">Critical Risk</option>
                        </select>
                    </div>
                    
                    <!-- Review Status Filter -->
                    <div class="min-w-[150px]">
                        <label class="block text-sm font-soehneKraftig text-gray-700 mb-1">Review Status</label>
                        <select id="statusFilter" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-conflixis-green">
                            <option value="">All Status</option>
                            <option value="pending">Pending Review</option>
                            <option value="in_review">In Review</option>
                            <option value="approved">Approved</option>
                            <option value="requires_management">Requires Management Plan</option>
                        </select>
                    </div>
                    
                    <!-- Management Plan Filter -->
                    <div class="min-w-[150px]">
                        <label class="block text-sm font-soehneKraftig text-gray-700 mb-1">Management Plan</label>
                        <select id="planFilter" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-conflixis-green">
                            <option value="">All</option>
                            <option value="required">Plan Required</option>
                            <option value="not_required">No Plan Required</option>
                        </select>
                    </div>
                    
                    <!-- Apply Filters Button -->
                    <button onclick="applyFilters()" 
                            class="px-6 py-2 bg-conflixis-blue text-white rounded-lg hover:bg-opacity-90 transition-all">
                        Apply Filters
                    </button>
                    
                    <!-- Clear Filters Button -->
                    <button onclick="clearFilters()" 
                            class="px-4 py-2 text-conflixis-green hover:text-conflixis-blue transition-all">
                        Clear
                    </button>
                </div>
                
                <!-- Active Filters Display -->
                <div id="activeFilters" class="mt-4 flex flex-wrap gap-2 hidden">
                    <!-- Active filter tags will be added here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Summary Stats -->
    <section class="pb-6">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-soehneKraftig text-conflixis-green" id="totalCount">0</div>
                    <div class="text-xs text-gray-600">Total Disclosures</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-soehneKraftig text-green-600" id="lowRiskCount">0</div>
                    <div class="text-xs text-gray-600">Low Risk</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-soehneKraftig text-yellow-600" id="moderateRiskCount">0</div>
                    <div class="text-xs text-gray-600">Moderate Risk</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-soehneKraftig text-orange-600" id="highRiskCount">0</div>
                    <div class="text-xs text-gray-600">High Risk</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-soehneKraftig text-red-600" id="criticalRiskCount">0</div>
                    <div class="text-xs text-gray-600">Critical Risk</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-soehneKraftig text-conflixis-blue" id="pendingReviewCount">0</div>
                    <div class="text-xs text-gray-600">Pending Review</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Data Table -->
    <section class="pb-8">
        <div class="container mx-auto px-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold">Disclosure Records</h2>
                        <div class="text-sm text-gray-600">
                            Showing <span id="recordsShowing">0</span> of <span id="recordsTotal">0</span> records
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full min-w-[1200px]">
                        <thead class="bg-conflixis-tan sticky top-0 z-10">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('provider_name')">
                                    <div class="flex items-center gap-1">
                                        Provider
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('category_label')">
                                    <div class="flex items-center gap-1">
                                        Category
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('relationship_type')">
                                    <div class="flex items-center gap-1">
                                        Disclosure Type
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('entity_name')">
                                    <div class="flex items-center gap-1">
                                        Company Name
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('financial_amount')">
                                    <div class="flex items-center gap-1">
                                        Amount
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('risk_tier')">
                                    <div class="flex items-center gap-1">
                                        Risk Tier
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('review_status')">
                                    <div class="flex items-center gap-1">
                                        Status
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('management_plan_required')">
                                    <div class="flex items-center gap-1">
                                        Mgmt Plan
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('last_review_date')">
                                    <div class="flex items-center gap-1">
                                        Last Review
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-soehneKraftig text-gray-700 uppercase cursor-pointer hover:bg-conflixis-tan hover:bg-opacity-80" 
                                    onclick="sortTable('id')">
                                    <div class="flex items-center gap-1">
                                        Doc ID (debug)
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                        </svg>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody" class="divide-y divide-gray-200">
                            <!-- Data rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="p-4 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <div class="flex gap-2">
                            <select id="pageSize" onchange="changePageSize()" 
                                    class="px-3 py-1 border border-gray-300 rounded-lg text-sm">
                                <option value="10">10 per page</option>
                                <option value="25" selected>25 per page</option>
                                <option value="50">50 per page</option>
                                <option value="100">100 per page</option>
                            </select>
                        </div>
                        <div class="flex gap-2" id="pagination">
                            <!-- Pagination buttons will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </div> <!-- End of Main Content -->

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop fixed inset-0" onclick="closeModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto relative animate-fade-in">
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-start">
                    <h3 class="text-2xl font-bold text-conflixis-green">Disclosure Details</h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="modalContent" class="p-6">
                    <!-- Modal content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- API Client -->
    <script src="api.js"></script>
    
    <script>
        // Initialize API client
        const apiClient = new DisclosureAPIClient();
        
        // Data storage
        let disclosureData = {
            metadata: {
                generated: "2025-01-08",
                record_count: 0,
                data_range: "2024-01-01 to 2024-12-31"
            },
            disclosures: []
        };

        // Current state
        let currentPage = 1;
        let pageSize = 25;
        let filteredData = [];
        let sortColumn = null;
        let sortDirection = 'asc';


        // Load data from API only
        async function loadData() {
            try {
                // Check if API is available
                const health = await apiClient.healthCheck();
                
                if (!health.data_loaded) {
                    throw new Error('API has no data loaded. Please run scripts/fetch_json_data.py to fetch data from BigQuery.');
                }
                
                // Load ALL data from API by paginating
                let allRecords = [];
                let page = 1;
                const pageSize = 100;
                let totalPages = 1;
                
                // Show loading message
                const tbody = document.getElementById('dataTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="px-6 py-8 text-center">
                            <div class="text-gray-600">Loading data...</div>
                        </td>
                    </tr>
                `;
                
                // Load all pages
                while (page <= totalPages) {
                    console.log(`Fetching page ${page} of ${totalPages}...`);
                    const response = await apiClient.getDisclosures({ 
                        page: page, 
                        page_size: pageSize 
                    });
                    
                    console.log(`Page ${page}: received ${response.data.length} records`);
                    allRecords = allRecords.concat(response.data);
                    totalPages = response.pages || Math.ceil(response.total / pageSize);
                    
                    // Update loading message
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="11" class="px-6 py-8 text-center">
                                <div class="text-gray-600">Loading data... (${allRecords.length} of ${response.total} records)</div>
                            </td>
                        </tr>
                    `;
                    
                    page++;
                }
                
                console.log(`Total records loaded: ${allRecords.length}`);
                
                const stats = await apiClient.getOverviewStats();
                
                disclosureData = {
                    metadata: {
                        generated: new Date().toISOString(),
                        record_count: allRecords.length,
                        data_range: "API Data",
                        ...stats
                    },
                    disclosures: allRecords
                };
                
                filteredData = [...disclosureData.disclosures];
                updateDisplay();
                updateStats();
                
            } catch (error) {
                console.error('Failed to load data:', error);
                
                // Show error message to user
                const tbody = document.getElementById('dataTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="px-6 py-8 text-center">
                            <div class="text-red-600 font-semibold mb-2">Failed to Load Data</div>
                            <div class="text-gray-600">${error.message}</div>
                            <div class="text-sm text-gray-500 mt-2">
                                Ensure the FastAPI backend is running: <code class="bg-gray-100 px-2 py-1 rounded">python app/main.py</code>
                            </div>
                        </td>
                    </tr>
                `;
                
                // Update stats to show error
                document.getElementById('totalCount').textContent = '0';
                document.getElementById('lowRiskCount').textContent = '0';
                document.getElementById('moderateRiskCount').textContent = '0';
                document.getElementById('highRiskCount').textContent = '0';
                document.getElementById('criticalRiskCount').textContent = '0';
                document.getElementById('pendingReviewCount').textContent = '0';
            }
        }

        // Apply filters
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const riskFilter = document.getElementById('riskFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const planFilter = document.getElementById('planFilter').value;
            
            console.log('Applying filters:', { searchTerm, riskFilter, statusFilter, planFilter });
            console.log('Total records before filter:', disclosureData.disclosures.length);
            
            filteredData = disclosureData.disclosures.filter(record => {
                // Search filter
                if (searchTerm) {
                    const searchMatch = 
                        (record.provider_name && record.provider_name.toLowerCase().includes(searchTerm)) ||
                        (record.category_label && record.category_label.toLowerCase().includes(searchTerm)) ||
                        (record.department && record.department.toLowerCase().includes(searchTerm)) ||
                        (record.job_title && record.job_title.toLowerCase().includes(searchTerm)) ||
                        (record.entity_name && record.entity_name.toLowerCase().includes(searchTerm)) ||
                        (record.relationship_type && record.relationship_type.toLowerCase().includes(searchTerm));
                    if (!searchMatch) return false;
                }
                
                // Risk tier filter
                if (riskFilter && record.risk_tier !== riskFilter) return false;
                
                // Status filter
                if (statusFilter && record.review_status !== statusFilter) return false;
                
                // Management plan filter
                if (planFilter) {
                    if (planFilter === 'required' && !record.management_plan_required) return false;
                    if (planFilter === 'not_required' && record.management_plan_required) return false;
                }
                
                return true;
            });
            
            console.log('Filtered records:', filteredData.length);
            
            currentPage = 1;
            updateDisplay();
            updateStats();
            showActiveFilters();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('riskFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('planFilter').value = '';
            filteredData = [...disclosureData.disclosures];
            currentPage = 1;
            updateDisplay();
            updateStats();
            document.getElementById('activeFilters').classList.add('hidden');
        }

        // Show active filters
        function showActiveFilters() {
            const container = document.getElementById('activeFilters');
            container.innerHTML = '';
            let hasFilters = false;
            
            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm) {
                container.innerHTML += `<span class="px-3 py-1 bg-conflixis-mint text-white rounded-full text-sm">Search: ${searchTerm}</span>`;
                hasFilters = true;
            }
            
            const riskFilter = document.getElementById('riskFilter').value;
            if (riskFilter) {
                container.innerHTML += `<span class="px-3 py-1 bg-conflixis-mint text-white rounded-full text-sm">Risk: ${riskFilter}</span>`;
                hasFilters = true;
            }
            
            container.classList.toggle('hidden', !hasFilters);
        }

        // Sort table
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            filteredData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            updateDisplay();
        }

        // Update display
        function updateDisplay() {
            const tbody = document.getElementById('dataTableBody');
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filteredData.slice(start, end);
            
            tbody.innerHTML = '';
            
            pageData.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => showDetails(record);
                
                const riskColor = {
                    low: 'bg-green-100 text-green-800',
                    moderate: 'bg-yellow-100 text-yellow-800',
                    high: 'bg-orange-100 text-orange-800',
                    critical: 'bg-red-100 text-red-800'
                }[record.risk_tier];
                
                const statusColor = {
                    pending: 'bg-gray-100 text-gray-800',
                    in_review: 'bg-blue-100 text-blue-800',
                    approved: 'bg-green-100 text-green-800',
                    requires_management: 'bg-orange-100 text-orange-800'
                }[record.review_status];
                
                row.innerHTML = `
                    <td class="px-4 py-3">
                        <div class="text-sm font-soehneKraftig">${record.provider_name}</div>
                        <div class="flex text-xs text-gray-500 gap-2">
                            <span>${record.job_title || 'Not Specified'}</span>
                            <span>•</span>
                            <span>${record.department || 'Healthcare'}</span>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm">${record.category_label || 'Open Payments'}</td>
                    <td class="px-4 py-3 text-sm">${record.relationship_type || 'Not Specified'}</td>
                    <td class="px-4 py-3 text-sm">${record.entity_name || ''}</td>
                    <td class="px-4 py-3 text-sm font-soehneKraftig">
                        ${record.financial_amount === null || record.financial_amount === undefined ? 
                            'N/A' : 
                            record.financial_amount === 0 ? 
                                '$-' : 
                                '$' + record.financial_amount.toLocaleString()}
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 text-xs rounded-full ${riskColor}">
                            ${record.risk_tier.charAt(0).toUpperCase() + record.risk_tier.slice(1)}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 text-xs rounded-full ${statusColor}">
                            ${record.review_status.replace('_', ' ').charAt(0).toUpperCase() + record.review_status.slice(1).replace('_', ' ')}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${record.management_plan_required ? 
                            '<span class="text-xs text-conflixis-red font-soehneKraftig">Required</span>' : 
                            '<span class="text-xs text-gray-400">—</span>'}
                    </td>
                    <td class="px-4 py-3 text-sm whitespace-nowrap">${record.last_review_date}</td>
                    <td class="px-4 py-3 text-xs font-mono text-gray-500">${record.id || ''}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update counts
            document.getElementById('recordsShowing').textContent = pageData.length;
            document.getElementById('recordsTotal').textContent = filteredData.length;
            
            // Update pagination
            updatePagination();
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = `px-3 py-1 border rounded-lg text-sm ${currentPage === 1 ? 'border-gray-200 text-gray-400' : 'border-gray-300 hover:bg-gray-50'}`;
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateDisplay();
                }
            };
            pagination.appendChild(prevBtn);
            
            // Page numbers
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `px-3 py-1 border rounded-lg text-sm ${i === currentPage ? 'bg-conflixis-green text-white' : 'border-gray-300 hover:bg-gray-50'}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    updateDisplay();
                };
                pagination.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = `px-3 py-1 border rounded-lg text-sm ${currentPage === totalPages ? 'border-gray-200 text-gray-400' : 'border-gray-300 hover:bg-gray-50'}`;
            nextBtn.textContent = 'Next';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateDisplay();
                }
            };
            pagination.appendChild(nextBtn);
        }

        // Change page size
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            updateDisplay();
        }

        // Update statistics
        function updateStats() {
            const stats = {
                total: filteredData.length,
                low: filteredData.filter(r => r.risk_tier === 'low').length,
                moderate: filteredData.filter(r => r.risk_tier === 'moderate').length,
                high: filteredData.filter(r => r.risk_tier === 'high').length,
                critical: filteredData.filter(r => r.risk_tier === 'critical').length,
                pending: filteredData.filter(r => r.review_status === 'pending').length
            };
            
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('lowRiskCount').textContent = stats.low;
            document.getElementById('moderateRiskCount').textContent = stats.moderate;
            document.getElementById('highRiskCount').textContent = stats.high;
            document.getElementById('criticalRiskCount').textContent = stats.critical;
            document.getElementById('pendingReviewCount').textContent = stats.pending;
            
            // Update sidebar stats
            document.getElementById('sidebarTotalCount').textContent = stats.total;
            document.getElementById('sidebarPendingCount').textContent = stats.pending;
            document.getElementById('sidebarCriticalCount').textContent = stats.critical;
        }
        
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.getElementById('sidebarToggle');
            
            sidebar.classList.toggle('sidebar-collapsed');
            mainContent.classList.toggle('main-content-expanded');
            toggleBtn.classList.toggle('hidden');
        }
        
        // Toggle admin submenu
        function toggleAdminMenu() {
            const submenu = document.getElementById('adminSubmenu');
            const toggle = document.getElementById('adminToggle');
            
            submenu.classList.toggle('expanded');
            toggle.classList.toggle('rotated');
        }

        // Show details modal with proper form based on category/type
        function showDetails(record) {
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('modalContent');
            const modalTitle = document.querySelector('#detailModal h3');
            
            // Update modal title to show category and type  
            modalTitle.innerHTML = `${record.category_label || 'Disclosure'} - ${record.relationship_type || 'Details'}`;
            
            const riskColor = {
                low: 'text-green-600 bg-green-50',
                moderate: 'text-yellow-600 bg-yellow-50', 
                high: 'text-orange-600 bg-orange-50',
                critical: 'text-red-600 bg-red-50'
            }[record.risk_tier] || 'text-gray-600 bg-gray-50';
            
            // Get the appropriate form content
            let formContent = getFormContent(record);
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Category Badge and Overview -->
                    <div class="flex items-center justify-between border-b pb-4">
                        <div>
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold mr-2
                                ${getCategoryColor(record.category_label)}">
                                ${record.category_label}
                            </span>
                            <span class="text-sm text-gray-600">${record.relationship_type}</span>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-3 py-1 rounded-lg text-xs font-semibold ${riskColor}">
                                ${record.risk_tier.toUpperCase()} RISK
                            </span>
                        </div>
                    </div>
                    
                    <!-- Provider Information Card -->
                    <div class="bg-gradient-to-r from-conflixis-green to-teal-700 text-white rounded-lg p-4">
                        <div class="flex items-start justify-between">
                            <div>
                                <h4 class="text-lg font-bold">${record.provider_name}</h4>
                                <p class="text-sm opacity-90">${record.job_title || 'Not Specified'}</p>
                                <p class="text-sm opacity-90">${record.department || 'Healthcare'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs opacity-75">NPI</p>
                                <p class="font-mono text-sm">${record.provider_npi || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dynamic Form Content -->
                    <div>
                        <h4 class="text-sm font-semibold text-gray-500 mb-3">Disclosure Form</h4>
                        ${formContent}
                    </div>
                    
                    <!-- Financial Summary -->
                    <div class="bg-gradient-to-r from-conflixis-gold to-yellow-400 text-white rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs opacity-90 uppercase">Total Disclosed Amount</p>
                                <p class="text-3xl font-bold">
                                    ${record.financial_amount === null || record.financial_amount === undefined ? 
                                        'N/A' : 
                                        record.financial_amount === 0 ? 
                                            '$-' : 
                                            '$' + record.financial_amount.toLocaleString()}
                                </p>
                            </div>
                            ${record.open_payments_total > 0 ? `
                            <div class="text-right">
                                <p class="text-xs opacity-90">Open Payments Match</p>
                                <p class="text-lg font-semibold">$${record.open_payments_total.toLocaleString()}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Management Actions -->
                    <div>
                        <h4 class="text-sm font-semibold text-gray-500 mb-3">Management & Review</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="border-l-4 border-conflixis-blue pl-3">
                                    <span class="text-xs text-gray-500">Review Status</span>
                                    <p class="font-semibold capitalize">${record.review_status.replace('_', ' ')}</p>
                                </div>
                                <div class="border-l-4 ${record.management_plan_required ? 'border-red-500' : 'border-green-500'} pl-3">
                                    <span class="text-xs text-gray-500">Management Plan</span>
                                    <p class="font-semibold">${record.management_plan_required ? 'Required' : 'Not Required'}</p>
                                </div>
                                <div class="border-l-4 border-gray-400 pl-3">
                                    <span class="text-xs text-gray-500">Last Review</span>
                                    <p class="font-semibold">${record.last_review_date}</p>
                                </div>
                                <div class="border-l-4 border-purple-500 pl-3">
                                    <span class="text-xs text-gray-500">Next Review</span>
                                    <p class="font-semibold">${record.next_review_date}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Policy Guidance (System-generated) -->
                    ${getPolicyNote(record.category_label, record.relationship_type) ? `
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-semibold text-sm mb-2 text-blue-700">Policy Guidance</h5>
                        <p class="text-sm text-gray-700">${getPolicyNote(record.category_label, record.relationship_type)}</p>
                    </div>
                    ` : ''}
                    
                    <!-- Document Info Footer -->
                    <div class="border-t pt-4 flex justify-between items-center text-xs text-gray-500">
                        <div>
                            <span>Document ID: </span>
                            <span class="font-mono">${record.id}</span>
                        </div>
                        <div>
                            <span>Disclosed: </span>
                            <span>${record.disclosure_date}</span>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Get category color classes
        function getCategoryColor(category) {
            const colors = {
                'External Roles & Relationships': 'bg-blue-100 text-blue-700',
                'Financial & Investment Interests': 'bg-yellow-100 text-yellow-700',
                'Open Payments (CMS Imports)': 'bg-green-100 text-green-700',
                'Political & Charitable Activities': 'bg-purple-100 text-purple-700',
                'Legal & Compliance Matters': 'bg-red-100 text-red-700'
            };
            return colors[category] || 'bg-gray-100 text-gray-700';
        }
        
        // Get form content based on category and type
        function getFormContent(record) {
            const category = record.category_label;
            const type = record.relationship_type;
            
            // External Roles & Relationships Forms
            if (category === 'External Roles & Relationships') {
                if (type === 'Related Parties') {
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Related Person Name</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name || 'Not Specified'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Relationship Type</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Family Member</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Related Person's Entity</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.department || 'Texas Health'}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Related Person's Job Title</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.job_title || 'Not Specified'}</p>
                                    </div>
                                </div>
                                ${record.notes ? `
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else if (type === 'Governance/Director Fees') {
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Organization Name</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Board Position/Role</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Board Member</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Annual Compensation</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded font-semibold">
                                            ${record.financial_amount ? '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                        </p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Time Commitment</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Monthly Meetings</p>
                                    </div>
                                </div>
                                ${record.notes ? `
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Financial & Investment Interests Forms
            if (category === 'Financial & Investment Interests') {
                if (type === 'Ownership/Investment') {
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Company Name</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Investment Type</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Equity Ownership</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Current Value</label>
                                        <p class="mt-1 p-2 bg-yellow-50 rounded font-bold text-lg">
                                            ${record.financial_amount ? '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                        </p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Ownership Percentage</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.equity_percentage || '< 5%'}</p>
                                    </div>
                                </div>
                                ${record.notes ? `
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else if (type === 'Receipt of Remuneration') {
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Company Providing Gift</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Type of Remuneration</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Food and Beverage</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Total Value</label>
                                        <p class="mt-1 p-2 bg-yellow-50 rounded font-semibold">
                                            ${record.financial_amount ? '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                        </p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Date Received</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.disclosure_date}</p>
                                    </div>
                                </div>
                                ${record.notes ? `
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else if (type === 'Receipt of Compensation') {
                    return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Payer Organization</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Service Provided</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Consulting Services</p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Total Compensation</label>
                                        <p class="mt-1 p-2 bg-yellow-50 rounded font-bold text-lg">
                                            ${record.financial_amount ? '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                        </p>
                                    </div>
                                    <div>
                                        <label class="text-xs font-semibold text-gray-600">Payment Period</label>
                                        <p class="mt-1 p-2 bg-gray-50 rounded">Annual</p>
                                    </div>
                                </div>
                                ${record.notes ? `
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Open Payments Forms
            if (category === 'Open Payments (CMS Imports)') {
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <div class="space-y-4">
                            <div class="bg-green-50 p-3 rounded mb-4">
                                <p class="text-xs font-semibold text-green-700">CMS Open Payments Import</p>
                                <p class="text-xs text-green-600 mt-1">This disclosure was automatically imported from the CMS Open Payments database.</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Paying Entity</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                                </div>
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Payment Type</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded">General Payment</p>
                                </div>
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">Payment Amount</label>
                                    <p class="mt-1 p-2 bg-green-50 rounded font-bold">
                                        ${record.financial_amount ? '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                    </p>
                                </div>
                                <div>
                                    <label class="text-xs font-semibold text-gray-600">CMS Record Date</label>
                                    <p class="mt-1 p-2 bg-gray-50 rounded">${record.disclosure_date}</p>
                                </div>
                            </div>
                            ${record.notes ? `
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                            </div>
                            ` : ''}
                            <div class="border-t pt-3">
                                <p class="text-xs text-gray-500">Provider NPI: ${record.provider_npi || 'Not Available'}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Default form for unmatched types
            return `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Entity Name</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded">${record.entity_name}</p>
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Disclosure Type</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded">${record.relationship_type}</p>
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Financial Amount</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded font-semibold">
                                    ${record.financial_amount !== null && record.financial_amount !== undefined ? 
                                        '$' + record.financial_amount.toLocaleString() : 'N/A'}
                                </p>
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">Status</label>
                                <p class="mt-1 p-2 bg-gray-50 rounded">${record.review_status}</p>
                            </div>
                        </div>
                        ${record.notes ? `
                        <div>
                            <label class="text-xs font-semibold text-gray-600">Additional Notes</label>
                            <p class="mt-1 p-2 bg-gray-50 rounded italic">${record.notes}</p>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Get policy note based on category and type
        function getPolicyNote(category, type) {
            if (category === 'External Roles & Relationships') {
                if (type === 'Related Parties') {
                    return 'Family relationships within the organization must be disclosed to ensure appropriate management of potential conflicts.';
                } else if (type === 'Governance/Director Fees') {
                    return 'Board positions and governance roles must be disclosed and evaluated for conflicts with organizational interests.';
                } else {
                    return 'External activities must be reviewed to ensure they do not interfere with job responsibilities or create conflicts.';
                }
            } else if (category === 'Financial & Investment Interests') {
                if (type === 'Ownership/Investment') {
                    return 'Ownership interests in vendors, competitors, or related entities require disclosure and may need management plans.';
                } else if (type === 'Receipt of Remuneration') {
                    return 'Gifts and meals from vendors must be disclosed per the Sunshine Act and organizational gift policies.';
                } else if (type === 'Receipt of Compensation') {
                    return 'External compensation arrangements require review to ensure compliance with Stark Law and Anti-Kickback regulations.';
                }
            } else if (category === 'Open Payments (CMS Imports)') {
                return 'CMS Open Payments data is automatically imported to ensure transparency and compliance with federal reporting requirements.';
            }
            return null;
        }

        // Close modal
        function closeModal() {
            document.getElementById('detailModal').classList.add('hidden');
        }

        // Export data
        function exportData() {
            const csv = [
                ['Provider Name', 'Category', 'Disclosure Type', 'Company', 'Amount', 'Risk Tier', 'Status'],
                ...filteredData.map(r => [
                    r.provider_name,
                    r.category_label || 'Open Payments',
                    r.relationship_type || 'Not Specified',
                    r.entity_name,
                    r.financial_amount,
                    r.risk_tier,
                    r.review_status
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `disclosure_data_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadData().then(() => {
                // Check if there's a disclosure ID in the URL hash
                if (window.location.hash) {
                    const disclosureId = window.location.hash.substring(1);
                    // Find the disclosure with this ID
                    const disclosure = allData.find(d => d.id === disclosureId);
                    if (disclosure) {
                        // Show the details modal for this disclosure
                        showDetails(disclosure);
                    }
                }
            });
            
            // Enter key on search
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
            
            // Handle hash changes (if user navigates back)
            window.addEventListener('hashchange', function() {
                if (window.location.hash) {
                    const disclosureId = window.location.hash.substring(1);
                    const disclosure = allData.find(d => d.id === disclosureId);
                    if (disclosure) {
                        showDetails(disclosure);
                    }
                } else {
                    // Close modal if hash is removed
                    const modal = document.getElementById('detailModal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                }
            });
        });
    </script>
</body>
</html>