# Healthcare COI Analytics Report Template

## 1. Overview

This project provides a reusable template for generating a comprehensive, investigative analysis of healthcare provider conflicts of interest for any given health system. It uses BigQuery for data analysis and generates a multi-sheet Excel report and a Markdown report suitable for PDF conversion.

The entire process is driven by a central configuration file, `CONFIG.yaml`.

## 2. Prerequisites

- Python 3.9+
- Access to the Google Cloud Platform (GCP) project containing the BigQuery datasets.
- A GCP service account key with BigQuery read permissions.
- A `.env` file in the project root containing your GCP service account key.

## 3. Quick Start Guide

### Step 1: Configure the Environment
Create a `.env` file in the root of this project directory (`projects/190-template-v3`):
```
GCP_SERVICE_ACCOUNT_KEY='{...}'
```
Replace `{...}` with the contents of your GCP service account JSON key.

### Step 2: Configure the Report
Open the `CONFIG.yaml` file and edit the following sections:

1.  **`health_system`**:
    -   `name`: The full name of the client health system (e.g., "Memorial Health System").
    -   `short_name`: A short abbreviation for file naming (e.g., "mhs").
    -   `npi_file`: The path to the provider NPI list.

2.  **`bigquery`**:
    -   `npi_table`: **Crucially, update the placeholder `[abbrev]` here.** For example, `mhs_health_npis`. This is the BigQuery table that will be created or used for the NPI list.

### Step 3: Add Provider Data
1.  Create a CSV file containing the list of provider NPIs for the client.
2.  Place this file in the `data/inputs/` directory.
3.  Ensure the `npi_file` path in `CONFIG.yaml` points to this new file.
    *A sample file is provided at `data/inputs/provider_npis.csv.sample`.*

### Step 4: Run the Analysis
Execute the main analysis script from the project root. This will run all the analysis steps in sequence.
```bash
# Make sure your virtual environment is activated
python /path/to/your/venv/bin/python scripts/run_full_analysis.py
```
*(Note: You will need to create the `run_full_analysis.py` orchestrator script, as it was not part of the original Corewell project.)*

## 4. Project Structure

-   `CONFIG.yaml`: The central configuration file. **All client-specific setup happens here.**
-   `data/`:
    -   `inputs/`: Place raw data files here (e.g., NPI lists).
    -   `processed/`: Intermediate data files generated by the analysis scripts are stored here.
-   `docs/`: Final Markdown reports can be stored here.
-   `reports/`: Final Excel reports are saved here.
-   `scripts/`: Contains the Python scripts that perform the analysis.
    -   `01_analyze_op_payments.py`: Analyzes Open Payments data.
    -   `02_analyze_prescription_patterns.py`: Analyzes prescribing data.
    -   `03_payment_influence_analysis.py`: Correlates payments and prescribing.
    -   `04_generate_excel_report.py`: Consolidates results into an Excel file.
-   `notebooks/`: Jupyter notebooks for exploratory data analysis.

## 5. How it Works

The scripts are designed to be modular and configuration-driven. When you run the main orchestrator script, it will:
1.  Read the `CONFIG.yaml` file.
2.  Use the `short_name` to dynamically name output files and BigQuery tables.
3.  Execute each analysis script in order, saving the processed data as CSVs.
4.  Generate a final, formatted Excel report in the `reports/` directory.
