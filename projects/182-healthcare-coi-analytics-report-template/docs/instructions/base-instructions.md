# Claude Instructions - Healthcare COI Report Generation

## Purpose
Generate a comprehensive, investigative analysis of healthcare provider conflicts of interest that uncovers both systematic patterns and hospital-specific insights through sophisticated correlation analysis and behavioral pattern recognition.

## CRITICAL: Data Integrity Requirements

### Absolute Rules - Never Violate These
1. **Only report numbers that exist in the data files**
2. **Never cite statistical tests without performing them**
3. **Never create subcategories without categorical data**
4. **Never describe individual patterns without individual-level data**
5. **Never invent correlations without running correlations**

### Data Availability
The primary data source for this analysis is **BigQuery**. Assume that all necessary data, including provider-level details, specialty tags, temporal information, and prescription data, is available for querying. Your primary task is to write and execute the necessary queries to uncover the insights required by the specific report type (Investigative or Academic).

---

## Quick Setup & Execution

### 1. Configure the Analysis
Edit `CONFIG.yaml`:
```yaml
health_system:
  name: "[Health System Name]"     # e.g., "Memorial Health System"
  short_name: "[ABBREV]"           # e.g., "MHS" (for file naming)
  npi_file: "data/inputs/provider_npis.csv"
```

### 2. Prepare Provider Data
Place NPI list in `data/inputs/provider_npis.csv`:
- Required column: `NPI` (10-digit provider identifier)
- Optional columns: `Full_Name`, `Primary_Specialty`
- This list will be used to query the relevant providers in BigQuery.

### 3. Run the Analysis
```bash
# From project directory
cd /home/incent/conflixis-data-projects/projects/182-healthcare-coi-analytics-report-template

# Run full pipeline (takes ~5 minutes)
/home/incent/conflixis-data-projects/venv/bin/python scripts/run_full_analysis.py
```

### 4. Find the Report
Output location: `data/output/[shortname]_coi_report_[timestamp].md`

---

## Discovery & Investigation Framework

### Finding Hospital-Specific Insights
Beyond the standard analysis, actively search for unique patterns by writing and executing exploratory queries against the BigQuery database.

#### 1. **Deep Dive Triggers**
Investigate further when you find:
- **"Krystexxa Moments"**: Drugs with >400x influence factors
- **Department Clusters**: Specialties with >90% payment acceptance
- **Temporal Spikes**: Sudden payment increases (>300% month-over-month)
- **Network Effects**: Groups of providers receiving payments from same manufacturer on same dates
- **Outlier Providers**: Individual providers with extreme prescribing patterns

#### 2. **Critical Questions to Answer**
- What makes THIS hospital unique in the payment landscape?
- Are there local specialty clinics or centers of excellence driving patterns?
- Which departments show vulnerability beyond the norm?
- What regional factors (local manufacturers, state regulations) affect patterns?
- How does this hospital compare to peer institutions?

### Behavioral Pattern Recognition
Identify and frame discoveries using academic terminology and behavioral concepts like Reciprocity, Social Proof, Commitment Escalation, etc.

### Critical Metrics to Always Calculate
- **Influence Factor**: Paid provider Rx / Unpaid provider Rx
- **ROI per Dollar**: (Additional Rx value) / Payment amount
- **Vulnerability Index**: % increase in prescribing with payments by provider type
- **Persistence Score**: Providers with consecutive year payments
- **Concentration Risk**: % of prescriptions from top 10% of prescribers
- **Network Density**: Providers receiving payments from same manufacturer

---

## Exploratory Analysis & Custom Scripts

### You Are Expected to Write Custom Scripts and Queries
When the standard analysis pipeline doesn't reveal sufficient insights, **CREATE custom scripts** to query BigQuery and explore the data further. You have full autonomy to investigate patterns and write code to uncover hospital-specific discoveries.

### Script Organization
Save exploratory scripts in a logical structure:
```
data/exploratory/
├── [hospital_shortname]_[date]/
│   ├── 01_network_analysis.py
│   ├── 02_department_breakdown.py
│   └── findings_summary.md
```

### Always Document Your Exploratory Work
Create a `findings_summary.md` for each exploratory session, detailing the scripts created, key discoveries, and any data limitations encountered.

---

## Analysis Completion Tracking

### CRITICAL: Always Include Analysis Checklist
Every generated report MUST include an analysis completion checklist at the end. This provides transparency about which analyses were performed. The checklist is automatically generated by `05_generate_report.py`.
