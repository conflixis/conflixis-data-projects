# Healthcare COI Analytics - PDF Conversion Tools

## Overview

This directory contains enhanced PDF conversion tools specifically designed for Healthcare Conflict of Interest (COI) analytics reports. The tools convert Markdown reports generated by the analytics pipeline into professionally branded PDF documents with proper formatting for executive presentation.

## Recent Improvements (September 2025)

### Enhanced PDF Conversion
- **Fixed Header/Footer Spacing**: Resolved text encroachment issues with increased margins and proper headsep/footskip settings
- **Professional Styling**: Enhanced typography and layout for executive-level reports
- **Conflixis Branding**: Integrated company colors and styling guidelines

### Project 182 Integration
The conversion tools are now optimized for use with the Healthcare COI Analytics Template (project 182), which includes:
- Automated report generation with LLM-powered narrative
- BigQuery integration for real-time data analysis
- Multiple report styles (investigative, compliance, executive)

## Prerequisites

Before using this tool, you must have the following software installed:

1. **Pandoc** (v2.14 or later): The core document conversion engine.
   - *Installation*: [https://pandoc.org/installing.html](https://pandoc.org/installing.html)

2. **XeTeX**: A modern TeX engine with excellent support for Unicode and modern fonts.
   - *On Ubuntu/Debian*: `sudo apt-get install texlive-xetex texlive-fonts-extra`
   - *On macOS (via MacTeX)*: `brew install --cask mactex`

3. **Additional LaTeX packages**:
   ```bash
   sudo apt-get install texlive-latex-extra texlive-fonts-recommended
   ```

## How to Use

### Method 1: From Project 182 Directory

For reports generated by the Healthcare COI Analytics Template:

```bash
cd /path/to/projects/182-healthcare-coi-analytics-report-template
cd conversion
./convert-enhanced.sh ../reports/[your_report].md
```

### Method 2: Using the Original Conversion Script

```bash
cd /path/to/conflixis-data-projects/src/conversion
./convert.sh /path/to/your/report.md
```

### Method 3: Direct Pandoc Command

```bash
pandoc [your_report].md \
  --pdf-engine=xelatex \
  --metadata-file=pandoc-pdf-enhanced.yaml \
  --include-in-header=header-enhanced.tex \
  -o [your_report].pdf
```

## Template Files

### Enhanced Templates (Project 182)
Located in `projects/182-healthcare-coi-analytics-report-template/conversion/`:

- **`pandoc-pdf-enhanced.yaml`**: Enhanced configuration with:
  - Optimized margins (1.5in top/bottom)
  - Professional spacing (headsep: 25pt, footskip: 35pt)
  - Conflixis color scheme integration
  
- **`header-enhanced.tex`**: LaTeX header with:
  - Custom header/footer positioning
  - Professional typography settings
  - Executive report styling

### Original Templates
Located in `src/conversion/template/`:

- **`pandoc-pdf.yaml`**: Standard configuration file
- **`header.tex`**: Basic LaTeX header definitions
- **`assets/`**: Company logos and static assets

## Configuration Options

### Page Layout
```yaml
geometry:
  - top=1.5in      # Increased to prevent header overlap
  - bottom=1.5in   # Increased to prevent footer overlap
  - left=1in
  - right=1in
  - headsep=25pt   # Space between header and text
  - footskip=35pt  # Space between footer and text
```

### Typography
```yaml
mainfont: "Helvetica Neue"
sansfont: "Helvetica Neue Light"
monofont: "Courier New"
fontsize: 11pt
linestretch: 1.15
```

### Professional Features
- Automatic table of contents generation
- Numbered sections with proper hierarchy
- Code syntax highlighting
- Professional table formatting
- Executive summary styling

## Troubleshooting

### Common Issues

1. **Text overlapping headers/footers**
   - Solution: Ensure you're using the enhanced templates with proper margin settings
   - Check headsep and footskip values in YAML configuration

2. **Missing fonts**
   - Install required fonts: `sudo apt-get install texlive-fonts-extra`
   - Or specify alternative fonts in the YAML configuration

3. **LaTeX errors**
   - Ensure all prerequisites are installed
   - Check for special characters in Markdown that need escaping

### Debug Mode
To see detailed pandoc processing:
```bash
pandoc --verbose [your_report].md --pdf-engine=xelatex -o [output].pdf
```

## Integration with Analytics Pipeline

The conversion tools are designed to work seamlessly with reports generated by:
- Healthcare COI Analytics Template (Project 182)
- Open Payments analysis scripts
- Prescription pattern analysis tools
- Risk assessment pipelines

Reports are automatically formatted with:
- Executive summaries
- Data visualizations
- Risk matrices
- Compliance recommendations
- Methodology appendices

## Support

For issues or questions:
- Check the project documentation in `docs/USER_GUIDE.md`
- Review examples in `docs/examples/`
- Contact the Conflixis Data Analytics Team
